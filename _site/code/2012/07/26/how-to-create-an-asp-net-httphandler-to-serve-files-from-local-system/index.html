<!DOCTYPE html>
<html lang="en-us">
  <head>
  <link href="http://gmpg.org/xfn/11" rel="profile">
  <meta http-equiv="content-type" content="text/html; charset=utf-8">

  <!-- Enable responsiveness on mobile devices-->
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">

  <title>
    
      How to create an ASP.NET HttpHandler to serve files from local system &middot; Joe Kampschmidt
    
  </title>

  <!-- CSS -->
  <link rel="stylesheet" href="/public/css/poole.css">
  <link rel="stylesheet" href="/public/css/syntax.css">
  <link href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,400,600,700' rel='stylesheet' type='text/css'>

  <!-- Icons -->
  <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/public/apple-touch-icon-precomposed.png">
  <link rel="shortcut icon" href="/public/favicon.ico">

  <!-- RSS -->
  <link rel="alternate" type="application/rss+xml" title="RSS" href="/atom.xml">
</head>

  <body>
    <div class="masthead">
      <div class="container center">

      <h3 class="masthead-title">
        <a href="/" title="also known as @jokecamp">Joe Kampschmidt</a>
      </h3>
      <div class="center"><small>Joe's Code - a pragmatic approach to web and software development</small></div>

      <nav class="nav">
        <a class="" href="/">Home</a>
        
        
          
            
          
        
          
        
          
            
          
        
          
            
              <a class="" href="/posts/" title="Blog Posts">Blog Posts</a>
            
          
        
          
            
              <a class="" href="/projects/" title="Projects">Projects</a>
            
          
        
          
        
        <a href="https://github.com/jokecamp" title="Joe's github page - commit all the things">GitHub</a>
        <a href="http://stackoverflow.com/users/215502/kampsj" title="Joe's stackoverflow account - aka street credit">StackOverflow</a>
        <a href="https://twitter.com/jokecamp" title="Joe's twitter account">Twitter</a>
      </div>
      </nav>
    </div>
    <div class="container content">
      <div class="post">
  <h1 class="post-title">How to create an ASP.NET HttpHandler to serve files from local system</h1>
  <span class="post-date">26 Jul 2012</span>
  <p>*<em>How do you serve files on a local system (or network share) from an ASP.NET website? *</em></p>

<p>The problem is that browsers do not play well with file:/// as links. IE will allow it but Chrome and Firefox will block these links for security purposes.  See <a href="http://stackoverflow.com/questions/1254572/cross-browser-link-to-file-on-local-system">http://stackoverflow.com/questions/1254572/cross-browser-link-to-file-on-local-system</a></p>

<p>One solution is to create an HTTP Handler in your ASP.NET application. This handler will simply retrieve the network file and serve it up.</p>
<div class="highlight"><pre><code class="language-csharp" data-lang="csharp"><span class="k">public</span> <span class="k">class</span> <span class="nc">Downloader</span> <span class="p">:</span> <span class="n">IHttpHandler</span>
<span class="p">{</span>
    <span class="k">public</span> <span class="k">void</span> <span class="nf">ProcessRequest</span><span class="p">(</span><span class="n">HttpContext</span> <span class="n">context</span><span class="p">)</span>
    <span class="p">{</span>
        <span class="kt">string</span> <span class="n">path</span> <span class="p">=</span> <span class="s">&quot;//networkshare/path/hey.wav&quot;</span><span class="p">;</span>

        <span class="c1">// Hard coded but you can easily get from url parameters</span>
        <span class="c1">// string path = context.Request[&quot;path&quot;];</span>

        <span class="kt">var</span> <span class="n">file</span> <span class="p">=</span> <span class="k">new</span> <span class="n">FileInfo</span><span class="p">(</span><span class="n">path</span><span class="p">);</span>

        <span class="c1">// You should check for file.Exists !</span>

        <span class="n">context</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="n">Clear</span><span class="p">();</span>
        <span class="n">context</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="n">AddHeader</span><span class="p">(</span><span class="s">&quot;content-disposition&quot;</span><span class="p">,</span>
            <span class="kt">string</span><span class="p">.</span><span class="n">Format</span><span class="p">(</span><span class="s">&quot;attachment; filename=\&quot;{0}\&quot;&quot;</span><span class="p">,</span> <span class="n">file</span><span class="p">.</span><span class="n">Name</span><span class="p">));</span>
        <span class="n">context</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="n">ContentType</span> <span class="p">=</span> <span class="s">&quot;audio/wav&quot;</span><span class="p">;</span>
        <span class="n">context</span><span class="p">.</span><span class="n">Response</span><span class="p">.</span><span class="n">WriteFile</span><span class="p">(</span><span class="n">file</span><span class="p">.</span><span class="n">FullName</span><span class="p">,</span> <span class="k">false</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">public</span> <span class="kt">bool</span> <span class="n">IsReusable</span>
    <span class="p">{</span>
        <span class="k">get</span> <span class="p">{</span> <span class="k">return</span> <span class="k">false</span><span class="p">;</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre></div>
<p>Now we can allow users to download the file with direct link <strong>Downloader.ashx?path=x</strong>.</p>

<p><strong>Audio Files</strong></p>

<p>If you are serving audio files (as my example is doing) you can serve the file with the new HTML5 audio tag. Be sure your Response.ContentType agrees with the audio source type. Support for the different mime types and codecs is very inconsistent. You will want to <a href="http://html5doctor.com/html5-audio-the-state-of-play/">earn more about the current state of HTML 5 audio and modern browsers</a> before getting too deep in audio.</p>
<div class="highlight"><pre><code class="language-html" data-lang="html"><span class="nt">&lt;audio</span> <span class="na">controls=</span><span class="s">&quot;controls&quot;</span><span class="nt">&gt;</span>
  <span class="nt">&lt;source</span> <span class="na">src=</span><span class="s">&quot;Downloader.ashx?path=x&quot;</span> <span class="na">type=</span><span class="s">&quot;audio/wav&quot;</span> <span class="nt">/&gt;</span>
  Your browser does not support the audio element.
<span class="nt">&lt;/audio&gt;</span>
</code></pre></div>
<p><a href="http://jplayer.org/HTML5.Audio.Support/">See if your browser supports the new HTML 5 audio tags</a></p>

</div>

<div class="related">
  <h2>Related Posts</h2>
  <ul class="related-posts">
    
      <li>
          <a href="//code/2014/06/28/alternate-way-to-build-your-own-football-db-sqlite-database/">
            Alternate way to build your own football.db sqlite database
            <small>28 Jun 2014</small>
          </a>
      </li>
    
      <li>
          <a href="//fun/2014/06/07/building-a-raspberry-pi-photo-frame/">
            Building a Raspberry Pi Photo Frame
            <small>07 Jun 2014</small>
          </a>
      </li>
    
      <li>
          <a href="//code/2014/06/06/resolving-angularjs-paths-in-asp-mvc-spa-iis/">
            Resolving AngularJS paths in a ASP.NET MVC SPA and IIS
            <small>06 Jun 2014</small>
          </a>
      </li>
    
  </ul>
</div>

      <div class="footer">
        <p><a href="/atom.xml" title="Atom Feed">Atom</a> | <a href="/rss.xml" title="RSS Feed">RSS</a></p>
        <p>Contact me at <a href="mailto:joe.kampschmidt@gmail.com" alt="email me">joe.kampschmdit@gmail.com</p>
      </div>
    </div>
  </body>
</html>
